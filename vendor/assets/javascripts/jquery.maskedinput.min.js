(function(e){"function"===typeof define&&define.amd?define(["jquery"],e):"object"===typeof exports?e(require("jquery")):e(jQuery)})(function(e){var n=navigator.userAgent,F=/iphone/i.test(n),G=/chrome/i.test(n),B=/android/i.test(n),C;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"};e.fn.extend({caret:function(e,g){var h;if(0!==this.length&&!this.is(":hidden")&&this.get(0)===document.activeElement){if("number"==typeof e)return g="number"===
typeof g?g:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,g):this.createTextRange&&(h=this.createTextRange(),h.collapse(!0),h.moveEnd("character",g),h.moveStart("character",e),h.select())});this[0].setSelectionRange?(e=this[0].selectionStart,g=this[0].selectionEnd):document.selection&&document.selection.createRange&&(h=document.selection.createRange(),e=0-h.duplicate().moveStart("character",-1E5),g=e+h.text.length);return{begin:e,end:g}}},unmask:function(){return this.trigger("unmask")},
mask:function(p,g){var h,x,k,v,q,n,m,y;if(!p&&0<this.length)return h=e(this[0]),(h=h.data(e.mask.dataName))?h():void 0;g=e.extend({autoclear:e.mask.autoclear,placeholder:e.mask.placeholder,completed:null},g);x=e.mask.definitions;k=[];v=m=p.length;q=null;p=String(p);e.each(p.split(""),function(e,g){"?"==g?(m--,v=e):x[g]?(k.push(new RegExp(x[g])),null===q&&(q=k.length-1),e<v&&(n=k.length-1)):k.push(null)});return this.trigger("unmask").each(function(){function h(){if(g.completed){for(var a=q;a<=n;a++)if(k[a]&&
l[a]===r(a))return;g.completed.call(f)}}function r(a){return a<g.placeholder.length?g.placeholder.charAt(a):g.placeholder.charAt(0)}function t(a){for(;++a<m&&!k[a];);return a}function D(a,d){var b,c;if(!(0>a)){b=a;for(c=t(d);b<m;b++)if(k[b]){if(c<m&&k[b].test(l[c]))l[b]=l[c],l[c]=r(c);else break;c=t(c)}w();f.caret(Math.max(q,a))}}function H(a){var d,b,c;d=a;for(a=r(a);d<m;d++)if(k[d])if(b=t(d),c=l[d],l[d]=a,b<m&&k[b].test(c))a=c;else break}function I(a){var d=f.val();a=f.caret();if(y&&y.length&&y.length>
d.length){for(u(!0);0<a.begin&&!k[a.begin-1];)a.begin--;if(0===a.begin)for(;a.begin<q&&!k[a.begin];)a.begin++}else u(!0),d=d.charAt(a.begin),a.begin<m&&(k[a.begin]||a.begin++,k[a.begin].test(d)&&a.begin++);f.caret(a.begin,a.begin);h()}function E(a){u();f.val()!=A&&f.change()}function z(a,d){var b;for(b=a;b<d&&b<m;b++)k[b]&&(l[b]=r(b))}function w(){f.val(l.join(""))}function u(a){var d=f.val(),b=-1,c,e,h;for(h=c=0;c<m;c++)if(k[c]){for(l[c]=r(c);h++<d.length;)if(e=d.charAt(h-1),k[c].test(e)){l[c]=e;
b=c;break}if(h>d.length){z(c+1,m);break}}else l[c]===d.charAt(h)&&h++,c<v&&(b=c);a?w():b+1<v?g.autoclear||l.join("")===J?(f.val()&&f.val(""),z(0,m)):w():(w(),f.val(f.val().substring(0,b+1)));return v?c:q}var f=e(this),l=e.map(p.split(""),function(a,d){if("?"!=a)return x[a]?r(d):a}),J=l.join(""),A=f.val();f.data(e.mask.dataName,function(){return e.map(l,function(a,d){return k[d]&&a!=r(d)?a:null}).join("")});f.one("unmask",function(){f.off(".mask").removeData(e.mask.dataName)}).on("focus.mask",function(){if(!f.prop("readonly")){clearTimeout(C);
var a;A=f.val();a=u();C=setTimeout(function(){f.get(0)===document.activeElement&&(w(),a==p.replace("?","").length?f.caret(0,a):f.caret(a))},10)}}).on("blur.mask",E).on("keydown.mask",function(a){if(!f.prop("readonly")){var d=a.which||a.keyCode,b,c;y=f.val();if(8===d||46===d||F&&127===d){b=f.caret();c=b.begin;b=b.end;if(0===b-c){if(46!==d)for(;0<=--c&&!k[c];);else c=b=t(c-1);b=46===d?t(b):b}z(c,b);D(c,b-1);a.preventDefault()}else 13===d?E.call(this,a):27===d&&(f.val(A),f.caret(0,u()),a.preventDefault())}}).on("keypress.mask",
function(a){if(!f.prop("readonly")){var d=a.which||a.keyCode,b=f.caret(),c,g;a.ctrlKey||a.altKey||a.metaKey||32>d||!d||13===d||(0!==b.end-b.begin&&(z(b.begin,b.end),D(b.begin,b.end-1)),c=t(b.begin-1),c<m&&(d=String.fromCharCode(d),k[c].test(d)&&(H(c),l[c]=d,w(),g=t(c),B?setTimeout(function(){e.proxy(e.fn.caret,f,g)()},0):f.caret(g),b.begin<=n&&h())),a.preventDefault())}}).on("input.mask paste.mask",function(){f.prop("readonly")||setTimeout(function(){var a=u(!0);f.caret(a);h()},0)});if(G&&B)f.off("input.mask").on("input.mask",
I);u()})}})});
